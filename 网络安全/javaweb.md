
# java web安全
## 常见问题      
1.控制访问的权限。只让可以访问的访问到最小的资源和权限。     
2.控制输入内容。所有输入都可能是不安全的，所以要过滤。      
3.保证业务的安全。      
4.保证数据的安全性。     
5.控制输出内容。要过滤输出的内容，解决浏览器安全问题。        

### 1.控制访问权限
spring security提供了一个很好的权限控制的安全框架     
对于文件的直接访问，对于安全要求度高的文件建议放在WEB-INFO下面这样用户不能直接访问                
如果放在webroot下面，要设置外部不能访问需要单独设置过滤器，                   
spring boot项目更方便，按照springboot的默认设置，只有public，static等几个文件夹下的文件可被外部访问              

### 2.控制输入内容
一切外部输入的都是不安全，容易引起sql注入，xss问题。              
1.对于外部输入，可以利用filter或者aop对参数特殊字符进行转换，如< &等（可以防止sql注入和部分XSS）也可以用户输入的内容转码 decode下 
2.对于会影响数据安全的和数据完整性的表单提交，除了前端验证后端也需要添加验证
          
文件输入输出：    
控制文件的类型，                       
控制文件大小                           
如果文件内容是重要的，则遇到文件下载时需要使用具有随机性的命名，以防通过命名规则下载其他不可下载的文件                      

sql注入         
除了上面的输入参数转换以外，我们一般使用hibernate框架，或者springboot的data jpa ，切记尽量不要使用sql拼接  
数据库用户权限尽量不要太大       
拖库：                
11年csdn发生了一起用户资料被盗取的事件           
支持外链接的情况只需要攻破用户名密码则可以通过navicat等工具连接数据库进行拖库    
不支持外链接的情况下则可以使用sqlMap进行sql注入获取表结构，数据库等信息，然后构造出导出数据库的sql            


### 保证业务的安全
#### 1.防止暴力破解               
用户密码尽量复杂。                    
日志记录登陆操作                     
表单提交或者登陆尽量加上验证码。               
限制登录次数          
暴力破解工具                  
C/S架构如mysql，sqlserver常见的破解工具有Hydra，Medusa等，具体使用可自行百度       
B/S架构除了上面说的Hydra，Medusa，还有burpsuit也是可以进行暴力破解的                  

#### 2，权限控制              
每一个访问尽量做到权限控制，如访问到本来不能访问的订单数据               

### 保证数据安全
不可以预见性
对于重要资源，要随机性，要不然容易被测试到规则，全部拖走。如agent的数据之前ID用自增长数据
控制资源访问的频率
比如，只允许同一个ip访问100次每天。
记录数据操作记录
重要的信息操作的时候，要有记录。实现思路：通过aop。

### csrf攻击：
对于重要的操作可以判断url是否来自本网站，添加token等，googel recaptcha也可以一定程度上防止csrf攻击
spring security也有配置可以设置csrf的过滤器

### 其他：
如果设置cookie，需要设置为httponly

### 安全验证工具
1.burp suite，可惜scanner部分是收费的，所以只可以用此工具做手工验证                  
2.sqlMap  sql注入的验证工具               
3.findbugs eclipse插件，用来查看代码的逻辑漏洞等                   
                    

## 补充说明
加密说明
### （1）对称加密与非对称加密（双向加密）
对称加密：也叫密钥加密，速度快，加密和解密的钥匙必须相同，只有通信双方才能知道钥匙；  
常用的对称加密有：DES、IDEA、RC2、RC4、SKIPJACK、RC5、AES算法等                   

非对称加密：也叫公钥加密，速度慢，加密和解密的钥匙不相同，某一个人持有私钥，任何人都可以知道公钥；             
公开密钥与私有密钥是一对，如果用公开密钥对数据进行加密，只有用对应的私有密钥才能解密；如果用私有密钥对数据进行加密，那么只有用对应的公开密钥才能解密。因为加密和解密使用的是两个不同的密钥，所以这种算法叫作非对称加密算法。          
RSA、DSA           

通常 , 使用的加密算法 比较简便高效 , 密钥简短，加解密速度快，破译极其困难。但是加密的安全性依靠密钥保管的安全性 , 在公开的计算机网络上安全地传送和保管密钥是一个严峻的问题，并且如果在多用户的情况下密钥的保管安全性也是一个问题。        
单钥密码体制的代表是美国的 DES                  

### （2）数字摘要与MD5/SHA算法（单向加密）

作用：数据的完整性校验；                
一个消息摘要就是一个数据块的数字指纹。即对一个任意长度的一个数据块进行计算，产生一个唯一指印（对于 SHA1 是产生一个 20 字节的二进制数组）。

消息摘要有两个基本属性：               
两个不同的报文难以生成相同的摘要                  
难以对指定的摘要生成一个报文，而由该报文反推算出该指定的摘要         
代表：美国国家标准技术研究所的 SHA1 和麻省理工学院 Ronald Rivest 提出的 MD5                 

#### MD5 
MD5（信息-摘要算法），广泛用于加密和解密技术，常用于文件校验。不管文件多大，经过MD5后都能生成唯一的MD5值。比较文件是否一样

#### SHA(Secure Hash Algorithm，安全散列算法）
数字签名等密码学应用中重要的工具，被广泛地应用于电子商务等信息安全领域。虽然，SHA与MD5通过碰撞法都被破解了， 但是SHA仍然是公认的安全加密算法，较之MD5更为安全。             
SHA 是一种数据加密算法，该算法经过加密专家多年来的发展和改进已日益完善，现在已成为公认的最安全的散列算法之一，并被广泛使用。该算法的思想是接收一段明文，然后以一种不可逆的方式将它转换成一段（通常更小）密文，也可以简单的理解为取一串输入码（称为预映射或信息），并把它们转化为长度较短、位数固定的输出序列即散列值（也称为信息摘要或信息认证代码）的过程。散列函数值可以说时对明文的一种“指纹”或是“摘要”所以对散列值的数字签名就可以视为对此明文的数字签名。                

#### SHA-1与MD5的比较
因为二者均由MD4导出，SHA-1和MD5彼此很相似。相应的，他们的强度和其他特性也是相似，但还有以下几点不同：              
l 对强行攻击的安全性：最显著和最重要的区别是SHA-1摘要比MD5摘要长32 位。使用强行技术，产生任何一个报文使其摘要等于给定报摘要的难度对MD5是2^128数量级的操作，而对SHA-1则是2^160数量级的操作。这样，SHA-1对强行攻击有更大的强度。                
2 对密码分析的安全性：由于MD5的设计，易受密码分析的攻击，SHA-1显得不易受这样的攻击。            
3 速度：在相同的硬件上，SHA-1的运行速度比MD5慢。                

### （3）数字签名
功能：必须能够验证内容没有修改，必须能够验证内容确实是被发送方签署；                    
所谓数字签名就是信息发送者用其私钥对从所传报文中提取出的特征数据（或称数字指纹）进行 RSA 算法操作，以保证发信人无法抵赖曾发过该信息（即不可抵赖性），同时也确保信息报文在经签名后末被篡改（即完整性）。当信息接收者收到报文后，就可以用发送者的公钥对数字签名进行验证。　                

在数字签名中有重要作用的数字指纹是通过一类特殊的散列函数（HASH 函数）生成的，对这些 HASH 函数的特殊要求是：              

接受的输入报文数据没有长度限制；  
对任何输入报文数据生成固定长度的摘要（数字指纹）输出                 
从报文能方便地算出摘要；                    
难以对指定的摘要生成一个报文，而由该报文反推算出该指定的摘要；               
两个不同的报文难以生成相同的摘要                 
代表：DSA                  

方案：发送方的公钥可以验证发送方签名的真实性，数字摘要可以验证内容没有修改；                  

### （4）数控制访问的权限。             





